
@model Sample02.Models.ViewModels.OrderViewModel

@using Kendo.Mvc.UI

@{
    ViewBag.Title = "Order";
    ViewBag.HeaderName = "Order";

}




@using (Html.BeginForm())
{
    @Html.AntiForgeryToken();
    <div class="form-horizontal">
        @{
            Html.RenderAction("ShowToolbar", "Partial");
        }

    </div>

    <div class="form-horizontal border rounded p-2">

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.LabelFor(model => model.OrderCode, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.TextBoxFor(model => model.OrderCode, new { @id = "code", htmlAttributes = new { @class = "form-control col-md-2" } })
                @Html.ValidationMessageFor(model => model.OrderCode, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.OrderDate, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @(Html.Kendo().DatePicker()
              .Name("date") 
              .Min(new DateTime(1900, 1, 1)) 
              .Max(new DateTime(2099, 12, 31)) 
              .Value(DateTime.Today) //Set the value of the DatePicker.
                )
                @Html.ValidationMessageFor(model => model.OrderDate, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Customer_Ref, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.TextBoxFor(model => model.Customer_Ref, new { @id = "customer_ref", htmlAttributes = new { @class = "form-control col-md-2" } })
                @*@Html.DropDownListFor(model => model.Customer_Ref, new SelectList(
         Model.FillGrid(),
         "Id",
         "CustomerName",
         Model.Customer_Ref
         ),
        htmlAttributes: new {@id="customerList", @class = "form-control col-md-3", @onChange = "SelectedValue(this)" }
         )*@
                @Html.ValidationMessageFor(model => model.Customer_Ref, "", new { @class = "text-danger"  })
            </div>
        </div>

    </div>
}
<br />
<div class="row kendoGrid">
    @(Html.Kendo().Grid<Sample02.Models.DomainModels.DTO.EF.usp_OrderMaster_Select_Result>()
                               .Name("OrderGrid")
                               .Columns(columns =>
                               {

                                   columns.Bound(p => p.Id).Title("شناسه");
                                   columns.Bound(p => p.OrderCode).Title("Order Code");
                                   columns.Bound(p => p.OrderDate).Title("Order Date");
                                   columns.Bound(p => p.Customer_Ref).Title("Customer ID");
                                   columns.Bound(p => p.CustomerCode).Title("Customer Code");



                               })
                               .Pageable()
                               .Navigatable()
                               .Selectable()
                               .Sortable()
                               .Scrollable()
                               .Filterable()
                               .Events(events => events.Change("OnRowSelect"))
                               .DataSource(dataSource => dataSource
                                    .Ajax()
                                   .Batch(true)
                                   .PageSize(20)
                                   .ServerOperation(false)
                                   .Model(model => model.Id(order => order.Id))
                                   .Read(read => read.Action("FillGrid", "Order"))
                             )
    )

</div>

<script type="text/javascript">

    var ref_Order = {};
    var selectedCustomer_RefID=0;

    //$(document).ready(function () {
    //    $("#date").datepicker({ dateFormat: 'dd/mm/yy' });
    //});

            //************** Save ********************
        $("#btnSave").click(function () {

            ref_Product = {

                OrderCode: $('#code').val(),

                OrderDate: $('#date').val(),

                Customer_Ref: $('#customer_ref').val(),


            };

                $.ajax({

                    url: "/Order/Create",

                    data: JSON.stringify(ref_Product),

                    type: "POST",

                    contentType: "application/json;charset=utf-8",

                    dataType: "json",

                    success: function (result) {

                        //location.reload();
                        alert("Save is done!");

                    },

                    error: function (errormessage) {

                        
                        alert(errormessage.responseText);

                    }

                });
    })

    OnRowSelect = function (e) {
        var grid = $("#OrderGrid").data("kendoGrid");
        var selectedRow = this.dataItem(this.select());
        $("#code").val(selectedRow.OrderCode);
        $("#date").val(selectedRow.OrderDate);
        $("#customer_ref").val(selectedRow.Customer_Ref);
        ref_Order.Id = selectedRow.Id;
    }
    //***
    //OnComboBoxSelect = function (e) {
    //    var comboBox = $('#customerList').data("kendoComboBox");
    //    var selectedItem = this.dataItem(this.select());
    //    ref_Order.Customer_Ref = selectedItem.Id;
    //}

    //function SelectedValue(ddlObject) {

    //    var selectedValue = ddlObject.value;
    //    var selectedText = ddlObject.options[ddlObject.selectedIndex].innerHTML;
    //    ref_Order.Customer_Ref = selectedValue;
    //    selectedCustomer_RefID  = selectedValue;
    //    alert(selectedCustomer_RefID );
    //}


    </script>